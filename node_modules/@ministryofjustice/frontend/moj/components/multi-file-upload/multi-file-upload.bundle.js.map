{"version":3,"file":"multi-file-upload.bundle.js","sources":["../../../../src/moj/components/multi-file-upload/multi-file-upload.mjs"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-empty-function */\n\nimport { ConfigurableComponent } from 'govuk-frontend'\n\n/**\n * @augments {ConfigurableComponent<MultiFileUploadConfig>}\n */\nexport class MultiFileUpload extends ConfigurableComponent {\n  /**\n   * @param {Element | null} $root - HTML element to use for multi file upload\n   * @param {MultiFileUploadConfig} [config] - Multi file upload config\n   */\n  constructor($root, config = {}) {\n    super($root, config)\n\n    if (!MultiFileUpload.isSupported()) {\n      return this\n    }\n\n    const $feedbackContainer =\n      this.config.feedbackContainer.element ??\n      this.$root.querySelector(this.config.feedbackContainer.selector)\n\n    if (!$feedbackContainer || !($feedbackContainer instanceof HTMLElement)) {\n      return this\n    }\n\n    this.$feedbackContainer = $feedbackContainer\n\n    this.setupFileInput()\n    this.setupDropzone()\n    this.setupLabel()\n    this.setupStatusBox()\n\n    this.$root.addEventListener('click', this.onFileDeleteClick.bind(this))\n    this.$root.classList.add('moj-multi-file-upload--enhanced')\n  }\n\n  setupDropzone() {\n    this.$dropzone = document.createElement('div')\n    this.$dropzone.classList.add('moj-multi-file-upload__dropzone')\n\n    this.$dropzone.addEventListener('dragover', this.onDragOver.bind(this))\n    this.$dropzone.addEventListener('dragleave', this.onDragLeave.bind(this))\n    this.$dropzone.addEventListener('drop', this.onDrop.bind(this))\n\n    this.$fileInput.replaceWith(this.$dropzone)\n    this.$dropzone.appendChild(this.$fileInput)\n  }\n\n  setupLabel() {\n    const $label = document.createElement('label')\n    $label.setAttribute('for', this.$fileInput.id)\n    $label.classList.add('govuk-button', 'govuk-button--secondary')\n    $label.textContent = this.config.dropzoneButtonText\n\n    const $hint = document.createElement('p')\n    $hint.classList.add('govuk-body')\n    $hint.textContent = this.config.dropzoneHintText\n\n    this.$label = $label\n    this.$dropzone.append($hint)\n    this.$dropzone.append($label)\n  }\n\n  setupFileInput() {\n    this.$fileInput = /** @type {HTMLInputElement} */ (\n      this.$root.querySelector('.moj-multi-file-upload__input')\n    )\n    this.$fileInput.addEventListener('change', this.onFileChange.bind(this))\n    this.$fileInput.addEventListener('focus', this.onFileFocus.bind(this))\n    this.$fileInput.addEventListener('blur', this.onFileBlur.bind(this))\n  }\n\n  setupStatusBox() {\n    this.$status = document.createElement('div')\n    this.$status.classList.add('govuk-visually-hidden')\n    this.$status.setAttribute('aria-live', 'polite')\n    this.$status.setAttribute('role', 'status')\n    this.$dropzone.append(this.$status)\n  }\n\n  /**\n   * @param {DragEvent} event - Drag event\n   */\n  onDragOver(event) {\n    event.preventDefault()\n    this.$dropzone.classList.add('moj-multi-file-upload--dragover')\n  }\n\n  onDragLeave() {\n    this.$dropzone.classList.remove('moj-multi-file-upload--dragover')\n  }\n\n  /**\n   * @param {DragEvent} event - Drag event\n   */\n  onDrop(event) {\n    event.preventDefault()\n    this.$dropzone.classList.remove('moj-multi-file-upload--dragover')\n    this.$feedbackContainer.classList.remove('moj-hidden')\n    this.$status.textContent = this.config.uploadStatusText\n    this.uploadFiles(event.dataTransfer.files)\n  }\n\n  /**\n   * @param {FileList} files - File list\n   */\n  uploadFiles(files) {\n    for (const file of Array.from(files)) {\n      this.uploadFile(file)\n    }\n  }\n\n  onFileChange() {\n    this.$feedbackContainer.classList.remove('moj-hidden')\n    this.$status.textContent = this.config.uploadStatusText\n    this.uploadFiles(this.$fileInput.files)\n\n    const $fileInput = this.$fileInput.cloneNode(true)\n    if (!$fileInput || !($fileInput instanceof HTMLInputElement)) {\n      return\n    }\n\n    $fileInput.value = ''\n    this.$fileInput.replaceWith($fileInput)\n\n    this.setupFileInput()\n    this.$fileInput.focus()\n  }\n\n  onFileFocus() {\n    this.$label.classList.add('moj-multi-file-upload--focused')\n  }\n\n  onFileBlur() {\n    this.$label.classList.remove('moj-multi-file-upload--focused')\n  }\n\n  /**\n   * @param {UploadResponseSuccess['success']} success\n   */\n  getSuccessHtml(success) {\n    return `<span class=\"moj-multi-file-upload__success\"> <svg class=\"moj-banner__icon\" fill=\"currentColor\" role=\"presentation\" focusable=\"false\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 25 25\" height=\"25\" width=\"25\"><path d=\"M25,6.2L8.7,23.2L0,14.1l4-4.2l4.7,4.9L21,2L25,6.2z\"/></svg>${success.messageHtml}</span>`\n  }\n\n  /**\n   * @param {UploadResponseError['error']} error\n   */\n  getErrorHtml(error) {\n    return `<span class=\"moj-multi-file-upload__error\"> <svg class=\"moj-banner__icon\" fill=\"currentColor\" role=\"presentation\" focusable=\"false\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 25 25\" height=\"25\" width=\"25\"><path d=\"M13.6,15.4h-2.3v-4.5h2.3V15.4z M13.6,19.8h-2.3v-2.2h2.3V19.8z M0,23.2h25L12.5,2L0,23.2z\"/></svg>${error.message}</span>`\n  }\n\n  /**\n   * @param {File} file\n   */\n  getFileRow(file) {\n    const $row = document.createElement('div')\n\n    $row.classList.add('govuk-summary-list__row', 'moj-multi-file-upload__row')\n\n    $row.innerHTML = `\n    <div class=\"govuk-summary-list__value moj-multi-file-upload__message\">\n      <span class=\"moj-multi-file-upload__filename\">${file.name}</span>\n      <span class=\"moj-multi-file-upload__progress\">0%</span>\n    </div>\n    <div class=\"govuk-summary-list__actions moj-multi-file-upload__actions\"></div>\n  `\n\n    return $row\n  }\n\n  /**\n   * @param {UploadResponseFile} file\n   */\n  getDeleteButton(file) {\n    const $button = document.createElement('button')\n\n    $button.setAttribute('type', 'button')\n    $button.setAttribute('name', 'delete')\n    $button.setAttribute('value', file.filename)\n\n    $button.classList.add(\n      'moj-multi-file-upload__delete',\n      'govuk-button',\n      'govuk-button--secondary',\n      'govuk-!-margin-bottom-0'\n    )\n\n    $button.innerHTML = `Delete <span class=\"govuk-visually-hidden\">${file.originalname}</span>`\n\n    return $button\n  }\n\n  /**\n   * @param {File} file\n   */\n  uploadFile(file) {\n    this.config.hooks.entryHook(this, file)\n\n    const $item = this.getFileRow(file)\n    const $message = $item.querySelector('.moj-multi-file-upload__message')\n    const $actions = $item.querySelector('.moj-multi-file-upload__actions')\n    const $progress = $item.querySelector('.moj-multi-file-upload__progress')\n\n    const formData = new FormData()\n    formData.append('documents', file)\n\n    this.$feedbackContainer\n      .querySelector('.moj-multi-file-upload__list')\n      .append($item)\n\n    const xhr = new XMLHttpRequest()\n\n    const onLoad = () => {\n      if (\n        xhr.status < 200 ||\n        xhr.status >= 300 ||\n        !('success' in xhr.response)\n      ) {\n        return onError()\n      }\n\n      $message.innerHTML = this.getSuccessHtml(xhr.response.success)\n      this.$status.textContent = xhr.response.success.messageText\n\n      $actions.append(this.getDeleteButton(xhr.response.file))\n      this.config.hooks.exitHook(this, file, xhr, xhr.responseText)\n    }\n\n    const onError = () => {\n      const error = new Error(\n        xhr.response && 'error' in xhr.response\n          ? xhr.response.error.message\n          : xhr.statusText || 'Upload failed'\n      )\n\n      $message.innerHTML = this.getErrorHtml(error)\n      this.$status.textContent = error.message\n\n      this.config.hooks.errorHook(this, file, xhr, xhr.responseText, error)\n    }\n\n    xhr.addEventListener('load', onLoad)\n    xhr.addEventListener('error', onError)\n\n    xhr.upload.addEventListener('progress', (event) => {\n      if (!event.lengthComputable) {\n        return\n      }\n\n      const percentComplete = Math.round((event.loaded / event.total) * 100)\n      $progress.textContent = ` ${percentComplete}%`\n    })\n\n    xhr.open('POST', this.config.uploadUrl)\n    xhr.responseType = 'json'\n\n    xhr.send(formData)\n  }\n\n  /**\n   * @param {MouseEvent} event - Click event\n   */\n  onFileDeleteClick(event) {\n    const $button = event.target\n\n    if (\n      !$button ||\n      !($button instanceof HTMLButtonElement) ||\n      !$button.classList.contains('moj-multi-file-upload__delete')\n    ) {\n      return\n    }\n\n    event.preventDefault() // if user refreshes page and then deletes\n\n    const xhr = new XMLHttpRequest()\n\n    xhr.addEventListener('load', () => {\n      if (xhr.status < 200 || xhr.status >= 300) {\n        return\n      }\n\n      const $rows = Array.from(\n        this.$feedbackContainer.querySelectorAll('.moj-multi-file-upload__row')\n      )\n\n      if ($rows.length === 1) {\n        this.$feedbackContainer.classList.add('moj-hidden')\n      }\n\n      const $rowDelete = $rows.find(($row) => $row.contains($button))\n      if ($rowDelete) $rowDelete.remove()\n\n      this.config.hooks.deleteHook(this, undefined, xhr, xhr.responseText)\n    })\n\n    xhr.open('POST', this.config.deleteUrl)\n    xhr.setRequestHeader('Content-Type', 'application/json')\n    xhr.responseType = 'json'\n\n    xhr.send(\n      JSON.stringify({\n        [$button.name]: $button.value\n      })\n    )\n  }\n\n  static isSupported() {\n    return (\n      this.isDragAndDropSupported() &&\n      this.isFormDataSupported() &&\n      this.isFileApiSupported()\n    )\n  }\n\n  static isDragAndDropSupported() {\n    const div = document.createElement('div')\n    return typeof div.ondrop !== 'undefined'\n  }\n\n  static isFormDataSupported() {\n    return typeof FormData === 'function'\n  }\n\n  static isFileApiSupported() {\n    const input = document.createElement('input')\n    input.type = 'file'\n    return typeof input.files !== 'undefined'\n  }\n\n  /**\n   * Name for the component used when initialising using data-module attributes.\n   */\n  static moduleName = 'moj-multi-file-upload'\n\n  /**\n   * Multi file upload default config\n   *\n   * @type {MultiFileUploadConfig}\n   */\n  static defaults = Object.freeze({\n    uploadStatusText: 'Uploading files, please wait',\n    dropzoneHintText: 'Drag and drop files here or',\n    dropzoneButtonText: 'Choose files',\n    feedbackContainer: {\n      selector: '.moj-multi-file__uploaded-files'\n    },\n    hooks: {\n      entryHook: () => {},\n      exitHook: () => {},\n      errorHook: () => {},\n      deleteHook: () => {}\n    }\n  })\n\n  /**\n   * Multi file upload config schema\n   *\n   * @satisfies {Schema<MultiFileUploadConfig>}\n   */\n  static schema = Object.freeze(\n    /** @type {const} */ ({\n      properties: {\n        uploadUrl: { type: 'string' },\n        deleteUrl: { type: 'string' },\n        uploadStatusText: { type: 'string' },\n        dropzoneHintText: { type: 'string' },\n        dropzoneButtonText: { type: 'string' },\n        feedbackContainer: { type: 'object' },\n        hooks: { type: 'object' }\n      }\n    })\n  )\n}\n\n/**\n * Multi file upload config\n *\n * @typedef {object} MultiFileUploadConfig\n * @property {string} [uploadUrl] - File upload URL\n * @property {string} [deleteUrl] - File delete URL\n * @property {string} [uploadStatusText] - Upload status text\n * @property {string} [dropzoneHintText] - Dropzone hint text\n * @property {string} [dropzoneButtonText] - Dropzone button text\n * @property {object} [feedbackContainer] - Feedback container config\n * @property {string} [feedbackContainer.selector] - Selector for feedback container\n * @property {Element | null} [feedbackContainer.element] - HTML element for feedback container\n * @property {MultiFileUploadHooks} [hooks] - Upload hooks\n */\n\n/**\n * Multi file upload hooks\n *\n * @typedef {object} MultiFileUploadHooks\n * @property {OnUploadFileEntryHook} [entryHook] - File upload entry hook\n * @property {OnUploadFileExitHook} [exitHook] - File upload exit hook\n * @property {OnUploadFileErrorHook} [errorHook] - File upload error hook\n * @property {OnUploadFileDeleteHook} [deleteHook] - File delete hook\n */\n\n/**\n * Upload hook: File entry\n *\n * @callback OnUploadFileEntryHook\n * @param {InstanceType<typeof MultiFileUpload>} upload - Multi file upload\n * @param {File} file - File upload\n */\n\n/**\n * Upload hook: File exit\n *\n * @callback OnUploadFileExitHook\n * @param {InstanceType<typeof MultiFileUpload>} upload - Multi file upload\n * @param {File} file - File upload\n * @param {XMLHttpRequest} xhr - XMLHttpRequest\n * @param {string} textStatus - Text status\n */\n\n/**\n * Upload hook: File error\n *\n * @callback OnUploadFileErrorHook\n * @param {InstanceType<typeof MultiFileUpload>} upload - Multi file upload\n * @param {File} file - File upload\n * @param {XMLHttpRequest} xhr - XMLHttpRequest\n * @param {string} textStatus - Text status\n * @param {Error} errorThrown - Error thrown\n */\n\n/**\n * Upload hook: File delete\n *\n * @callback OnUploadFileDeleteHook\n * @param {InstanceType<typeof MultiFileUpload>} upload - Multi file upload\n * @param {File} [file] - File upload\n * @param {XMLHttpRequest} xhr - XMLHttpRequest\n * @param {string} textStatus - Text status\n */\n\n/**\n * @typedef {object} UploadResponseSuccess\n * @property {{ messageText: string, messageHtml: string }} success - Response success\n * @property {UploadResponseFile} file - Response file\n */\n\n/**\n * @typedef {object} UploadResponseError\n * @property {{ message: string }} error - Response error\n * @property {UploadResponseFile} file - Response file\n */\n\n/**\n * @typedef {object} UploadResponseFile\n * @property {string} filename - File name\n * @property {string} originalname - Original file name\n */\n\n/**\n * @import { Schema } from 'govuk-frontend/dist/govuk/common/configuration.mjs'\n */\n"],"names":["MultiFileUpload","ConfigurableComponent","constructor","$root","config","_this$config$feedback","isSupported","$feedbackContainer","feedbackContainer","element","querySelector","selector","HTMLElement","setupFileInput","setupDropzone","setupLabel","setupStatusBox","addEventListener","onFileDeleteClick","bind","classList","add","$dropzone","document","createElement","onDragOver","onDragLeave","onDrop","$fileInput","replaceWith","appendChild","$label","setAttribute","id","textContent","dropzoneButtonText","$hint","dropzoneHintText","append","onFileChange","onFileFocus","onFileBlur","$status","event","preventDefault","remove","uploadStatusText","uploadFiles","dataTransfer","files","file","Array","from","uploadFile","cloneNode","HTMLInputElement","value","focus","getSuccessHtml","success","messageHtml","getErrorHtml","error","message","getFileRow","$row","innerHTML","name","getDeleteButton","$button","filename","originalname","hooks","entryHook","$item","$message","$actions","$progress","formData","FormData","xhr","XMLHttpRequest","onLoad","status","response","onError","messageText","exitHook","responseText","Error","statusText","errorHook","upload","lengthComputable","percentComplete","Math","round","loaded","total","open","uploadUrl","responseType","send","target","HTMLButtonElement","contains","$rows","querySelectorAll","length","$rowDelete","find","deleteHook","undefined","deleteUrl","setRequestHeader","JSON","stringify","isDragAndDropSupported","isFormDataSupported","isFileApiSupported","div","ondrop","input","type","moduleName","defaults","Object","freeze","schema","properties"],"mappings":"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"}