{"version":3,"file":"add-another.bundle.js","sources":["../../../../src/moj/components/add-another/add-another.mjs"],"sourcesContent":["import { Component } from 'govuk-frontend'\n\nexport class AddAnother extends Component {\n  /**\n   * @param {Element | null} $root - HTML element to use for add another\n   */\n  constructor($root) {\n    super($root)\n\n    this.$root.addEventListener('click', this.onRemoveButtonClick.bind(this))\n    this.$root.addEventListener('click', this.onAddButtonClick.bind(this))\n\n    const $buttons = this.$root.querySelectorAll(\n      '.moj-add-another__add-button, moj-add-another__remove-button'\n    )\n\n    $buttons.forEach(($button) => {\n      if (!($button instanceof HTMLButtonElement)) {\n        return\n      }\n\n      $button.type = 'button'\n    })\n  }\n\n  /**\n   * @param {MouseEvent} event - Click event\n   */\n  onAddButtonClick(event) {\n    const $button = event.target\n\n    if (\n      !$button ||\n      !($button instanceof HTMLButtonElement) ||\n      !$button.classList.contains('moj-add-another__add-button')\n    ) {\n      return\n    }\n\n    const $items = this.getItems()\n    const $item = this.getNewItem()\n\n    if (!$item || !($item instanceof HTMLElement)) {\n      return\n    }\n\n    this.updateAttributes($item, $items.length)\n    this.resetItem($item)\n\n    const $firstItem = $items[0]\n    if (!this.hasRemoveButton($firstItem)) {\n      this.createRemoveButton($firstItem)\n    }\n\n    $items[$items.length - 1].after($item)\n\n    const $input = $item.querySelector('input, textarea, select')\n    if ($input && $input instanceof HTMLInputElement) {\n      $input.focus()\n    }\n  }\n\n  /**\n   * @param {HTMLElement} $item - Add another item\n   */\n  hasRemoveButton($item) {\n    return $item.querySelectorAll('.moj-add-another__remove-button').length\n  }\n\n  getItems() {\n    if (!this.$root) {\n      return []\n    }\n\n    const $items = Array.from(\n      this.$root.querySelectorAll('.moj-add-another__item')\n    )\n\n    return $items.filter((item) => item instanceof HTMLElement)\n  }\n\n  getNewItem() {\n    const $items = this.getItems()\n    const $item = $items[0].cloneNode(true)\n\n    if (!$item || !($item instanceof HTMLElement)) {\n      return\n    }\n\n    if (!this.hasRemoveButton($item)) {\n      this.createRemoveButton($item)\n    }\n\n    return $item\n  }\n\n  /**\n   * @param {HTMLElement} $item - Add another item\n   * @param {number} index - Add another item index\n   */\n  updateAttributes($item, index) {\n    $item.querySelectorAll('[data-name]').forEach(($input) => {\n      if (!this.isValidInputElement($input)) {\n        return\n      }\n\n      const name = $input.getAttribute('data-name') || ''\n      const id = $input.getAttribute('data-id') || ''\n      const originalId = $input.id\n\n      $input.name = name.replace(/%index%/, `${index}`)\n      $input.id = id.replace(/%index%/, `${index}`)\n\n      const $label =\n        $input.parentElement.querySelector('label') ||\n        $input.closest('label') ||\n        $item.querySelector(`[for=\"${originalId}\"]`)\n\n      if ($label && $label instanceof HTMLLabelElement) {\n        $label.htmlFor = $input.id\n      }\n    })\n  }\n\n  /**\n   * @param {HTMLElement} $item - Add another item\n   */\n  createRemoveButton($item) {\n    const $button = document.createElement('button')\n    $button.type = 'button'\n\n    $button.classList.add(\n      'govuk-button',\n      'govuk-button--secondary',\n      'moj-add-another__remove-button'\n    )\n\n    $button.textContent = 'Remove'\n\n    $item.append($button)\n  }\n\n  /**\n   * @param {HTMLElement} $item - Add another item\n   */\n  resetItem($item) {\n    $item.querySelectorAll('[data-name], [data-id]').forEach(($input) => {\n      if (!this.isValidInputElement($input)) {\n        return\n      }\n\n      if ($input instanceof HTMLSelectElement) {\n        $input.selectedIndex = -1\n        $input.value = ''\n      } else if ($input instanceof HTMLTextAreaElement) {\n        $input.value = ''\n      } else {\n        switch ($input.type) {\n          case 'checkbox':\n          case 'radio':\n            $input.checked = false\n            break\n          default:\n            $input.value = ''\n        }\n      }\n    })\n  }\n\n  /**\n   * @param {MouseEvent} event - Click event\n   */\n  onRemoveButtonClick(event) {\n    const $button = event.target\n\n    if (\n      !$button ||\n      !($button instanceof HTMLButtonElement) ||\n      !$button.classList.contains('moj-add-another__remove-button')\n    ) {\n      return\n    }\n\n    $button.closest('.moj-add-another__item').remove()\n\n    const $items = this.getItems()\n\n    if ($items.length === 1) {\n      $items[0].querySelector('.moj-add-another__remove-button').remove()\n    }\n\n    $items.forEach(($item, index) => {\n      this.updateAttributes($item, index)\n    })\n\n    this.focusHeading()\n  }\n\n  focusHeading() {\n    const $heading = this.$root.querySelector('.moj-add-another__heading')\n\n    if ($heading && $heading instanceof HTMLElement) {\n      $heading.focus()\n    }\n  }\n\n  /**\n   * @param {Element} $input - the input to validate\n   */\n  isValidInputElement($input) {\n    return (\n      $input instanceof HTMLInputElement ||\n      $input instanceof HTMLSelectElement ||\n      $input instanceof HTMLTextAreaElement\n    )\n  }\n\n  /**\n   * Name for the component used when initialising using data-module attributes.\n   */\n  static moduleName = 'moj-add-another'\n}\n"],"names":["AddAnother","Component","constructor","$root","addEventListener","onRemoveButtonClick","bind","onAddButtonClick","$buttons","querySelectorAll","forEach","$button","HTMLButtonElement","type","event","target","classList","contains","$items","getItems","$item","getNewItem","HTMLElement","updateAttributes","length","resetItem","$firstItem","hasRemoveButton","createRemoveButton","after","$input","querySelector","HTMLInputElement","focus","Array","from","filter","item","cloneNode","index","isValidInputElement","name","getAttribute","id","originalId","replace","$label","parentElement","closest","HTMLLabelElement","htmlFor","document","createElement","add","textContent","append","HTMLSelectElement","selectedIndex","value","HTMLTextAreaElement","checked","remove","focusHeading","$heading","moduleName"],"mappings":"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"}