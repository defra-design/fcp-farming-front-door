{"version":3,"file":"date-picker.bundle.js","sources":["../../../../src/moj/components/date-picker/date-picker.mjs"],"sourcesContent":["import { ConfigurableComponent } from 'govuk-frontend'\n\n/**\n * @augments {ConfigurableComponent<DatePickerConfig>}\n */\nexport class DatePicker extends ConfigurableComponent {\n  /**\n   * @param {Element | null} $root - HTML element to use for date picker\n   * @param {DatePickerConfig} [config] - Date picker config\n   */\n  constructor($root, config = {}) {\n    super($root, config)\n\n    const $input =\n      this.config.input.element ??\n      this.$root.querySelector(this.config.input.selector)\n\n    if (!$input || !($input instanceof HTMLInputElement)) {\n      return this\n    }\n\n    this.$input = $input\n\n    this.dayLabels = [\n      'Monday',\n      'Tuesday',\n      'Wednesday',\n      'Thursday',\n      'Friday',\n      'Saturday',\n      'Sunday'\n    ]\n\n    this.monthLabels = [\n      'January',\n      'February',\n      'March',\n      'April',\n      'May',\n      'June',\n      'July',\n      'August',\n      'September',\n      'October',\n      'November',\n      'December'\n    ]\n\n    this.currentDate = new Date()\n    this.currentDate.setHours(0, 0, 0, 0)\n    this.calendarDays = /** @type {DSCalendarDay[]} */ ([])\n    this.excludedDates = /** @type {Date[]} */ ([])\n    this.excludedDays = /** @type {number[]} */ ([])\n\n    this.buttonClass = 'moj-datepicker__button'\n    this.selectedDayButtonClass = 'moj-datepicker__button--selected'\n    this.currentDayButtonClass = 'moj-datepicker__button--current'\n    this.todayButtonClass = 'moj-datepicker__button--today'\n\n    this.setOptions()\n    this.initControls()\n  }\n\n  initControls() {\n    this.id = `datepicker-${this.$input.id}`\n\n    this.$dialog = this.createDialog()\n    this.createCalendarHeaders()\n\n    const $componentWrapper = document.createElement('div')\n    const $inputWrapper = document.createElement('div')\n    $componentWrapper.classList.add('moj-datepicker__wrapper')\n    $inputWrapper.classList.add('govuk-input__wrapper')\n\n    this.$input.parentElement.insertBefore($componentWrapper, this.$input)\n    $componentWrapper.appendChild($inputWrapper)\n    $inputWrapper.appendChild(this.$input)\n\n    $inputWrapper.insertAdjacentHTML('beforeend', this.toggleTemplate())\n    $componentWrapper.insertAdjacentElement('beforeend', this.$dialog)\n\n    this.$calendarButton = /** @type {HTMLButtonElement} */ (\n      this.$root.querySelector('.moj-js-datepicker-toggle')\n    )\n\n    this.$dialogTitle = /** @type {HTMLHeadingElement} */ (\n      this.$dialog.querySelector('.moj-js-datepicker-month-year')\n    )\n\n    this.createCalendar()\n\n    this.$prevMonthButton = /** @type {HTMLButtonElement} */ (\n      this.$dialog.querySelector('.moj-js-datepicker-prev-month')\n    )\n\n    this.$prevYearButton = /** @type {HTMLButtonElement} */ (\n      this.$dialog.querySelector('.moj-js-datepicker-prev-year')\n    )\n\n    this.$nextMonthButton = /** @type {HTMLButtonElement} */ (\n      this.$dialog.querySelector('.moj-js-datepicker-next-month')\n    )\n\n    this.$nextYearButton = /** @type {HTMLButtonElement} */ (\n      this.$dialog.querySelector('.moj-js-datepicker-next-year')\n    )\n\n    this.$cancelButton = /** @type {HTMLButtonElement} */ (\n      this.$dialog.querySelector('.moj-js-datepicker-cancel')\n    )\n\n    this.$okButton = /** @type {HTMLButtonElement} */ (\n      this.$dialog.querySelector('.moj-js-datepicker-ok')\n    )\n\n    // add event listeners\n    this.$prevMonthButton.addEventListener('click', (event) =>\n      this.focusPreviousMonth(event, false)\n    )\n    this.$prevYearButton.addEventListener('click', (event) =>\n      this.focusPreviousYear(event, false)\n    )\n    this.$nextMonthButton.addEventListener('click', (event) =>\n      this.focusNextMonth(event, false)\n    )\n    this.$nextYearButton.addEventListener('click', (event) =>\n      this.focusNextYear(event, false)\n    )\n    this.$cancelButton.addEventListener('click', (event) => {\n      event.preventDefault()\n      this.closeDialog()\n    })\n    this.$okButton.addEventListener('click', () => {\n      this.selectDate(this.currentDate)\n    })\n\n    const $dialogButtons = this.$dialog.querySelectorAll(\n      'button:not([disabled=\"true\"])'\n    )\n\n    this.$firstButtonInDialog = $dialogButtons[0]\n    this.$lastButtonInDialog = $dialogButtons[$dialogButtons.length - 1]\n    this.$firstButtonInDialog.addEventListener('keydown', (event) =>\n      this.firstButtonKeydown(event)\n    )\n    this.$lastButtonInDialog.addEventListener('keydown', (event) =>\n      this.lastButtonKeydown(event)\n    )\n\n    this.$calendarButton.addEventListener('click', (event) =>\n      this.toggleDialog(event)\n    )\n\n    this.$dialog.addEventListener('keydown', (event) => {\n      if (event.key === 'Escape') {\n        this.closeDialog()\n        event.preventDefault()\n        event.stopPropagation()\n      }\n    })\n\n    document.body.addEventListener('mouseup', (event) => {\n      this.backgroundClick(event)\n    })\n\n    // populates calendar with initial dates, avoids Wave errors about null buttons\n    this.updateCalendar()\n  }\n\n  createDialog() {\n    const titleId = `datepicker-title-${this.$input.id}`\n    const $dialog = document.createElement('div')\n\n    $dialog.id = this.id\n    $dialog.setAttribute('class', 'moj-datepicker__dialog')\n    $dialog.setAttribute('role', 'dialog')\n    $dialog.setAttribute('aria-modal', 'true')\n    $dialog.setAttribute('aria-labelledby', titleId)\n    $dialog.innerHTML = this.dialogTemplate(titleId)\n    $dialog.hidden = true\n\n    return $dialog\n  }\n\n  createCalendar() {\n    const $tbody = this.$dialog.querySelector('tbody')\n    let dayCount = 0\n    for (let i = 0; i < 6; i++) {\n      // create row\n      const $row = $tbody.insertRow(i)\n\n      for (let j = 0; j < 7; j++) {\n        // create cell (day)\n        const $cell = document.createElement('td')\n        $row.appendChild($cell)\n        const $dateButton = document.createElement('button')\n        $dateButton.setAttribute('type', 'button')\n        $cell.appendChild($dateButton)\n\n        const calendarDay = new DSCalendarDay($dateButton, dayCount, i, j, this)\n        this.calendarDays.push(calendarDay)\n        dayCount++\n      }\n    }\n  }\n\n  toggleTemplate() {\n    return `<button class=\"moj-datepicker__toggle moj-js-datepicker-toggle\" type=\"button\" aria-haspopup=\"dialog\" aria-controls=\"${this.id}\" aria-expanded=\"false\">\n            <span class=\"govuk-visually-hidden\">Choose date</span>\n            <svg width=\"32\" height=\"24\" focusable=\"false\" class=\"moj-datepicker-icon\" aria-hidden=\"true\" role=\"img\" viewBox=\"0 0 22 22\">\n              <path\n                fill=\"currentColor\"\n                fill-rule=\"evenodd\"\n                clip-rule=\"evenodd\"\n                d=\"M16.1333 2.93333H5.86668V4.4C5.86668 5.21002 5.21003 5.86667 4.40002 5.86667C3.59 5.86667 2.93335 5.21002 2.93335 4.4V2.93333H2C0.895431 2.93333 0 3.82877 0 4.93334V19.2667C0 20.3712 0.89543 21.2667 2 21.2667H20C21.1046 21.2667 22 20.3712 22 19.2667V4.93333C22 3.82876 21.1046 2.93333 20 2.93333H19.0667V4.4C19.0667 5.21002 18.41 5.86667 17.6 5.86667C16.79 5.86667 16.1333 5.21002 16.1333 4.4V2.93333ZM20.5333 8.06667H1.46665V18.8C1.46665 19.3523 1.91436 19.8 2.46665 19.8H19.5333C20.0856 19.8 20.5333 19.3523 20.5333 18.8V8.06667Z\"\n              ></path>\n              <rect x=\"3.66669\" width=\"1.46667\" height=\"5.13333\" rx=\"0.733333\" fill=\"currentColor\"></rect>\n              <rect x=\"16.8667\" width=\"1.46667\" height=\"5.13333\" rx=\"0.733333\" fill=\"currentColor\"></rect>\n            </svg>\n          </button>`\n  }\n\n  /**\n   * HTML template for calendar dialog\n   *\n   * @param {string} [titleId] - Id attribute for dialog title\n   * @returns {string}\n   */\n  dialogTemplate(titleId) {\n    return `<div class=\"moj-datepicker__dialog-header\">\n            <div class=\"moj-datepicker__dialog-navbuttons\">\n              <button type=\"button\" class=\"moj-datepicker__button moj-js-datepicker-prev-year\">\n                <span class=\"govuk-visually-hidden\">Previous year</span>\n                <svg width=\"44\" height=\"40\" viewBox=\"0 0 44 40\" fill=\"none\" fill=\"none\" focusable=\"false\" aria-hidden=\"true\" role=\"img\">\n                  <path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M23.1643 20L28.9572 14.2071L27.5429 12.7929L20.3358 20L27.5429 27.2071L28.9572 25.7929L23.1643 20Z\" fill=\"currentColor\"/>\n                  <path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M17.1643 20L22.9572 14.2071L21.5429 12.7929L14.3358 20L21.5429 27.2071L22.9572 25.7929L17.1643 20Z\" fill=\"currentColor\"/>\n                </svg>\n              </button>\n\n              <button type=\"button\" class=\"moj-datepicker__button moj-js-datepicker-prev-month\">\n                <span class=\"govuk-visually-hidden\">Previous month</span>\n                <svg width=\"44\" height=\"40\" viewBox=\"0 0 44 40\" fill=\"none\" focusable=\"false\" aria-hidden=\"true\" role=\"img\">\n                  <path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M20.5729 20L25.7865 14.2071L24.5137 12.7929L18.0273 20L24.5137 27.2071L25.7865 25.7929L20.5729 20Z\" fill=\"currentColor\"/>\n                </svg>\n              </button>\n            </div>\n\n            <h2 id=\"${titleId}\" class=\"moj-datepicker__dialog-title moj-js-datepicker-month-year\" aria-live=\"polite\">June 2020</h2>\n\n            <div class=\"moj-datepicker__dialog-navbuttons\">\n              <button type=\"button\" class=\"moj-datepicker__button moj-js-datepicker-next-month\">\n                <span class=\"govuk-visually-hidden\">Next month</span>\n                <svg width=\"44\" height=\"40\" viewBox=\"0 0 44 40\" fill=\"none\"  focusable=\"false\" aria-hidden=\"true\" role=\"img\">\n                  <path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M23.4271 20L18.2135 14.2071L19.4863 12.7929L25.9727 20L19.4863 27.2071L18.2135 25.7929L23.4271 20Z\" fill=\"currentColor\"/>\n                </svg>\n              </button>\n\n              <button type=\"button\" class=\"moj-datepicker__button moj-js-datepicker-next-year\">\n                <span class=\"govuk-visually-hidden\">Next year</span>\n                <svg width=\"44\" height=\"40\" viewBox=\"0 0 44 40\" fill=\"none\" fill=\"none\" focusable=\"false\" aria-hidden=\"true\" role=\"img\">\n                  <path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M20.8357 20L15.0428 14.2071L16.4571 12.7929L23.6642 20L16.4571 27.2071L15.0428 25.7929L20.8357 20Z\" fill=\"currentColor\"/>\n                  <path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M26.8357 20L21.0428 14.2071L22.4571 12.7929L29.6642 20L22.4571 27.2071L21.0428 25.7929L26.8357 20Z\" fill=\"currentColor\"/>\n                </svg>\n              </button>\n            </div>\n          </div>\n\n          <table class=\"moj-datepicker__calendar moj-js-datepicker-grid\" role=\"grid\" aria-labelledby=\"${titleId}\">\n            <thead>\n              <tr></tr>\n            </thead>\n\n            <tbody></tbody>\n          </table>\n\n          <div class=\"govuk-button-group\">\n            <button type=\"button\" class=\"govuk-button moj-js-datepicker-ok\">Select</button>\n            <button type=\"button\" class=\"govuk-button govuk-button--secondary moj-js-datepicker-cancel\">Close</button>\n          </div>`\n  }\n\n  createCalendarHeaders() {\n    this.dayLabels.forEach((day) => {\n      const html = `<th scope=\"col\"><span aria-hidden=\"true\">${day.substring(0, 3)}</span><span class=\"govuk-visually-hidden\">${day}</span></th>`\n      const $headerRow = this.$dialog.querySelector('thead > tr')\n      $headerRow.insertAdjacentHTML('beforeend', html)\n    })\n  }\n\n  /**\n   * Pads given number with leading zeros\n   *\n   * @param {number} value - The value to be padded\n   * @param {number} length - The length in characters of the output\n   * @returns {string}\n   */\n  leadingZeros(value, length = 2) {\n    let ret = value.toString()\n\n    while (ret.length < length) {\n      ret = `0${ret}`\n    }\n\n    return ret\n  }\n\n  setOptions() {\n    this.setMinAndMaxDatesOnCalendar()\n    this.setExcludedDates()\n    this.setExcludedDays()\n    this.setWeekStartDay()\n  }\n\n  setMinAndMaxDatesOnCalendar() {\n    if (this.config.minDate) {\n      this.minDate = this.formattedDateFromString(this.config.minDate, null)\n      if (this.minDate && this.currentDate < this.minDate) {\n        this.currentDate = this.minDate\n      }\n    }\n\n    if (this.config.maxDate) {\n      this.maxDate = this.formattedDateFromString(this.config.maxDate, null)\n      if (this.maxDate && this.currentDate > this.maxDate) {\n        this.currentDate = this.maxDate\n      }\n    }\n  }\n\n  setExcludedDates() {\n    if (this.config.excludedDates) {\n      this.excludedDates = this.config.excludedDates\n        .replace(/\\s+/, ' ')\n        .split(' ')\n        .map((item) => {\n          return item.includes('-')\n            ? this.parseDateRangeString(item)\n            : [this.formattedDateFromString(item)]\n        })\n        .reduce((dates, items) => dates.concat(items))\n        .filter((date) => date)\n    }\n  }\n\n  /**\n   * Parses a daterange string into an array of dates\n   *\n   * @param {string} datestring - A daterange string in the format \"dd/mm/yyyy-dd/mm/yyyy\"\n   */\n  parseDateRangeString(datestring) {\n    const dates = []\n    const [startDate, endDate] = datestring\n      .split('-')\n      .map((d) => this.formattedDateFromString(d, null))\n\n    if (startDate && endDate) {\n      const date = new Date(startDate.getTime())\n      /* eslint-disable no-unmodified-loop-condition */\n      while (date <= endDate) {\n        dates.push(new Date(date))\n        date.setDate(date.getDate() + 1)\n      }\n      /* eslint-enable no-unmodified-loop-condition */\n    }\n    return dates\n  }\n\n  setExcludedDays() {\n    if (this.config.excludedDays) {\n      // lowercase and arrange dayLabels to put indexOf sunday == 0 for comparison\n      // with getDay() function\n      const weekDays = this.dayLabels.map((item) => item.toLowerCase())\n      if (this.config.weekStartDay === 'monday') {\n        weekDays.unshift(weekDays.pop())\n      }\n\n      this.excludedDays = this.config.excludedDays\n        .replace(/\\s+/, ' ')\n        .toLowerCase()\n        .split(' ')\n        .map((item) => weekDays.indexOf(item))\n        .filter((item) => item !== -1)\n    }\n  }\n\n  setWeekStartDay() {\n    const weekStartDayParam = this.config.weekStartDay\n    if (weekStartDayParam && weekStartDayParam.toLowerCase() === 'sunday') {\n      this.config.weekStartDay = 'sunday'\n      // Rotate dayLabels array to put Sunday as the first item\n      this.dayLabels.unshift(this.dayLabels.pop())\n    } else {\n      this.config.weekStartDay = 'monday'\n    }\n  }\n\n  /**\n   * Determine if a date is selectable\n   *\n   * @param {Date} date - the date to check\n   * @returns {boolean}\n   */\n  isExcludedDate(date) {\n    // This comparison does not work correctly - it will exclude the mindate itself\n    // see: https://github.com/ministryofjustice/moj-frontend/issues/923\n    if (this.minDate && this.minDate > date) {\n      return true\n    }\n\n    // This comparison works as expected - the maxdate will not be excluded\n    if (this.maxDate && this.maxDate < date) {\n      return true\n    }\n\n    for (const excludedDate of this.excludedDates) {\n      if (date.toDateString() === excludedDate.toDateString()) {\n        return true\n      }\n    }\n\n    if (this.excludedDays.includes(date.getDay())) {\n      return true\n    }\n\n    return false\n  }\n\n  /**\n   * Get a Date object from a string\n   *\n   * @param {string} dateString - string in the format d/m/yyyy dd/mm/yyyy\n   * @param {Date} fallback - date object to return if formatting fails\n   * @returns {Date}\n   */\n  formattedDateFromString(dateString, fallback = new Date()) {\n    let formattedDate = null\n    // Accepts d/m/yyyy and dd/mm/yyyy\n    const dateFormatPattern = /(\\d{1,2})([-/,. ])(\\d{1,2})\\2(\\d{4})/\n\n    if (!dateFormatPattern.test(dateString)) return fallback\n\n    const match = dateFormatPattern.exec(dateString)\n    const day = match[1]\n    const month = match[3]\n    const year = match[4]\n\n    formattedDate = new Date(`${year}-${month}-${day}`)\n    if (\n      formattedDate instanceof Date &&\n      Number.isFinite(formattedDate.getTime())\n    ) {\n      return formattedDate\n    }\n    return fallback\n  }\n\n  /**\n   * Get a formatted date string from a Date object\n   *\n   * @param {Date} date - date to format to a string\n   * @returns {string}\n   */\n  formattedDateFromDate(date) {\n    if (this.config.leadingZeros) {\n      return `${this.leadingZeros(date.getDate())}/${this.leadingZeros(date.getMonth() + 1)}/${date.getFullYear()}`\n    }\n\n    return `${date.getDate()}/${date.getMonth() + 1}/${date.getFullYear()}`\n  }\n\n  /**\n   * Get a human readable date in the format Monday 2 March 2024\n   *\n   * @param {Date} date - Date to format\n   * @returns {string}\n   */\n  formattedDateHuman(date) {\n    return `${this.dayLabels[(date.getDay() + 6) % 7]} ${date.getDate()} ${this.monthLabels[date.getMonth()]} ${date.getFullYear()}`\n  }\n\n  /**\n   * @param {MouseEvent} event - Click event\n   */\n  backgroundClick(event) {\n    if (\n      this.isOpen() &&\n      event.target instanceof Node &&\n      !this.$dialog.contains(event.target) &&\n      !this.$input.contains(event.target) &&\n      !this.$calendarButton.contains(event.target)\n    ) {\n      event.preventDefault()\n      this.closeDialog()\n    }\n  }\n\n  /**\n   * @param {KeyboardEvent} event - Keydown event\n   */\n  firstButtonKeydown(event) {\n    if (event.key === 'Tab' && event.shiftKey) {\n      this.$lastButtonInDialog.focus()\n      event.preventDefault()\n    }\n  }\n\n  /**\n   * @param {KeyboardEvent} event - Keydown event\n   */\n  lastButtonKeydown(event) {\n    if (event.key === 'Tab' && !event.shiftKey) {\n      this.$firstButtonInDialog.focus()\n      event.preventDefault()\n    }\n  }\n\n  // render calendar\n  updateCalendar() {\n    this.$dialogTitle.innerHTML = `${this.monthLabels[this.currentDate.getMonth()]} ${this.currentDate.getFullYear()}`\n\n    const day = this.currentDate\n    const firstOfMonth = new Date(day.getFullYear(), day.getMonth(), 1)\n    let dayOfWeek\n\n    if (this.config.weekStartDay === 'monday') {\n      dayOfWeek = firstOfMonth.getDay() === 0 ? 6 : firstOfMonth.getDay() - 1 // Change logic to make Monday first day of week, i.e. 0\n    } else {\n      dayOfWeek = firstOfMonth.getDay()\n    }\n\n    firstOfMonth.setDate(firstOfMonth.getDate() - dayOfWeek)\n\n    const thisDay = new Date(firstOfMonth)\n\n    // loop through our days\n    for (const calendarDay of this.calendarDays) {\n      const hidden = thisDay.getMonth() !== day.getMonth()\n      const disabled = this.isExcludedDate(thisDay)\n\n      calendarDay.update(thisDay, hidden, disabled)\n\n      thisDay.setDate(thisDay.getDate() + 1)\n    }\n  }\n\n  /**\n   * @param {boolean} [focus] - Focus the day button\n   */\n  setCurrentDate(focus = true) {\n    const { currentDate } = this\n    this.calendarDays.forEach((calendarDay) => {\n      calendarDay.$button.classList.add('moj-datepicker__button')\n      calendarDay.$button.classList.add('moj-datepicker__calendar-day')\n      calendarDay.$button.setAttribute('tabindex', '-1')\n      calendarDay.$button.classList.remove(this.selectedDayButtonClass)\n      const calendarDayDate = calendarDay.date\n      calendarDayDate.setHours(0, 0, 0, 0)\n\n      const today = new Date()\n      today.setHours(0, 0, 0, 0)\n\n      if (\n        calendarDayDate.getTime() ===\n        currentDate.getTime() /* && !calendarDay.button.disabled */\n      ) {\n        if (focus) {\n          calendarDay.$button.setAttribute('tabindex', '0')\n          calendarDay.$button.focus()\n          calendarDay.$button.classList.add(this.selectedDayButtonClass)\n        }\n      }\n\n      if (\n        this.inputDate &&\n        calendarDayDate.getTime() === this.inputDate.getTime()\n      ) {\n        calendarDay.$button.classList.add(this.currentDayButtonClass)\n        calendarDay.$button.setAttribute('aria-current', 'date')\n      } else {\n        calendarDay.$button.classList.remove(this.currentDayButtonClass)\n        calendarDay.$button.removeAttribute('aria-current')\n      }\n\n      if (calendarDayDate.getTime() === today.getTime()) {\n        calendarDay.$button.classList.add(this.todayButtonClass)\n      } else {\n        calendarDay.$button.classList.remove(this.todayButtonClass)\n      }\n    })\n\n    // if no date is tab-able, make the first non-disabled date tab-able\n    if (!focus) {\n      const enabledDays = this.calendarDays.filter((calendarDay) => {\n        return (\n          window.getComputedStyle(calendarDay.$button).display === 'block' &&\n          !calendarDay.$button.disabled\n        )\n      })\n\n      enabledDays[0].$button.setAttribute('tabindex', '0')\n\n      this.currentDate = enabledDays[0].date\n    }\n  }\n\n  /**\n   * @param {Date} date - Date to select\n   */\n  selectDate(date) {\n    if (this.isExcludedDate(date)) {\n      return\n    }\n\n    this.$calendarButton.querySelector('span').innerText =\n      `Choose date. Selected date is ${this.formattedDateHuman(date)}`\n    this.$input.value = this.formattedDateFromDate(date)\n\n    const changeEvent = new Event('change', { bubbles: true, cancelable: true })\n    this.$input.dispatchEvent(changeEvent)\n\n    this.closeDialog()\n  }\n\n  isOpen() {\n    return this.$dialog.classList.contains('moj-datepicker__dialog--open')\n  }\n\n  /**\n   * @param {MouseEvent} event - Click event\n   */\n  toggleDialog(event) {\n    event.preventDefault()\n    if (this.isOpen()) {\n      this.closeDialog()\n    } else {\n      this.setMinAndMaxDatesOnCalendar()\n      this.openDialog()\n    }\n  }\n\n  openDialog() {\n    this.$dialog.hidden = false\n    this.$dialog.classList.add('moj-datepicker__dialog--open')\n    this.$calendarButton.setAttribute('aria-expanded', 'true')\n\n    // position the dialog\n    // if input is wider than dialog pin it to the right\n    if (this.$input.offsetWidth > this.$dialog.offsetWidth) {\n      this.$dialog.style.right = `0px`\n    }\n    this.$dialog.style.top = `${this.$input.offsetHeight + 3}px`\n\n    // get the date from the input element\n    this.inputDate = this.formattedDateFromString(this.$input.value)\n    this.currentDate = this.inputDate\n    this.currentDate.setHours(0, 0, 0, 0)\n\n    this.updateCalendar()\n    this.setCurrentDate()\n  }\n\n  closeDialog() {\n    this.$dialog.hidden = true\n    this.$dialog.classList.remove('moj-datepicker__dialog--open')\n    this.$calendarButton.setAttribute('aria-expanded', 'false')\n    this.$calendarButton.focus()\n  }\n\n  /**\n   * @param {Date} date - Date to go to\n   * @param {boolean} [focus] - Focus the day button\n   */\n  goToDate(date, focus) {\n    const current = this.currentDate\n    this.currentDate = date\n\n    if (\n      current.getMonth() !== this.currentDate.getMonth() ||\n      current.getFullYear() !== this.currentDate.getFullYear()\n    ) {\n      this.updateCalendar()\n    }\n\n    this.setCurrentDate(focus)\n  }\n\n  // day navigation\n  focusNextDay() {\n    const date = new Date(this.currentDate)\n    date.setDate(date.getDate() + 1)\n    this.goToDate(date)\n  }\n\n  focusPreviousDay() {\n    const date = new Date(this.currentDate)\n    date.setDate(date.getDate() - 1)\n    this.goToDate(date)\n  }\n\n  // week navigation\n  focusNextWeek() {\n    const date = new Date(this.currentDate)\n    date.setDate(date.getDate() + 7)\n    this.goToDate(date)\n  }\n\n  focusPreviousWeek() {\n    const date = new Date(this.currentDate)\n    date.setDate(date.getDate() - 7)\n    this.goToDate(date)\n  }\n\n  focusFirstDayOfWeek() {\n    const date = new Date(this.currentDate)\n    const firstDayOfWeekIndex = this.config.weekStartDay === 'sunday' ? 0 : 1\n    const dayOfWeek = date.getDay()\n    const diff =\n      dayOfWeek >= firstDayOfWeekIndex\n        ? dayOfWeek - firstDayOfWeekIndex\n        : 6 - dayOfWeek\n\n    date.setDate(date.getDate() - diff)\n    date.setHours(0, 0, 0, 0)\n\n    this.goToDate(date)\n  }\n\n  focusLastDayOfWeek() {\n    const date = new Date(this.currentDate)\n    const lastDayOfWeekIndex = this.config.weekStartDay === 'sunday' ? 6 : 0\n    const dayOfWeek = date.getDay()\n    const diff =\n      dayOfWeek <= lastDayOfWeekIndex\n        ? lastDayOfWeekIndex - dayOfWeek\n        : 7 - dayOfWeek\n\n    date.setDate(date.getDate() + diff)\n    date.setHours(0, 0, 0, 0)\n\n    this.goToDate(date)\n  }\n\n  /**\n   * Month navigation\n   *\n   * @param {KeyboardEvent | MouseEvent} event - Key press or click event\n   * @param {boolean} [focus] - Focus the day button\n   */\n  focusNextMonth(event, focus = true) {\n    event.preventDefault()\n    const date = new Date(this.currentDate)\n    date.setMonth(date.getMonth() + 1, 1)\n    this.goToDate(date, focus)\n  }\n\n  /**\n   * @param {KeyboardEvent | MouseEvent} event - Key press or click event\n   * @param {boolean} [focus] - Focus the day button\n   */\n  focusPreviousMonth(event, focus = true) {\n    event.preventDefault()\n    const date = new Date(this.currentDate)\n    date.setMonth(date.getMonth() - 1, 1)\n    this.goToDate(date, focus)\n  }\n\n  /**\n   * Year navigation\n   *\n   * @param {KeyboardEvent | MouseEvent} event - Key press or click event\n   * @param {boolean} [focus] - Focus the day button\n   */\n  focusNextYear(event, focus = true) {\n    event.preventDefault()\n    const date = new Date(this.currentDate)\n    date.setFullYear(date.getFullYear() + 1, date.getMonth(), 1)\n    this.goToDate(date, focus)\n  }\n\n  /**\n   * @param {KeyboardEvent | MouseEvent} event - Key press or click event\n   * @param {boolean} [focus] - Focus the day button\n   */\n  focusPreviousYear(event, focus = true) {\n    event.preventDefault()\n    const date = new Date(this.currentDate)\n    date.setFullYear(date.getFullYear() - 1, date.getMonth(), 1)\n    this.goToDate(date, focus)\n  }\n\n  /**\n   * Name for the component used when initialising using data-module attributes.\n   */\n  static moduleName = 'moj-date-picker'\n\n  /**\n   * Date picker default config\n   *\n   * @type {DatePickerConfig}\n   */\n  static defaults = Object.freeze({\n    leadingZeros: false,\n    weekStartDay: 'monday',\n    input: {\n      selector: '.moj-js-datepicker-input'\n    }\n  })\n\n  /**\n   * Date picker config schema\n   *\n   * @satisfies {Schema<DatePickerConfig>}\n   */\n  static schema = Object.freeze(\n    /** @type {const} */ ({\n      properties: {\n        excludedDates: { type: 'string' },\n        excludedDays: { type: 'string' },\n        leadingZeros: { type: 'boolean' },\n        maxDate: { type: 'string' },\n        minDate: { type: 'string' },\n        weekStartDay: { type: 'string' },\n        input: { type: 'object' }\n      }\n    })\n  )\n}\n\nclass DSCalendarDay {\n  /**\n   *\n   * @param {HTMLButtonElement} $button\n   * @param {number} index\n   * @param {number} row\n   * @param {number} column\n   * @param {DatePicker} picker\n   */\n  constructor($button, index, row, column, picker) {\n    this.index = index\n    this.row = row\n    this.column = column\n    this.$button = $button\n    this.picker = picker\n    this.date = new Date()\n    this.$button.addEventListener('keydown', this.keyPress.bind(this))\n    this.$button.addEventListener('click', this.click.bind(this))\n  }\n\n  /**\n   * @param {Date} day - the Date for the calendar day\n   * @param {boolean} hidden - visibility of the day\n   * @param {boolean} disabled - is the day selectable or excluded\n   */\n  update(day, hidden, disabled) {\n    const label = day.getDate()\n    let accessibleLabel = this.picker.formattedDateHuman(day)\n\n    if (disabled) {\n      this.$button.setAttribute('aria-disabled', 'true')\n      accessibleLabel = `Excluded date, ${accessibleLabel}`\n    } else {\n      this.$button.removeAttribute('aria-disabled')\n    }\n\n    if (hidden) {\n      this.$button.style.display = 'none'\n    } else {\n      this.$button.style.display = 'block'\n    }\n    this.$button.setAttribute(\n      'data-testid',\n      this.picker.formattedDateFromDate(day)\n    )\n\n    this.$button.innerHTML = `<span class=\"govuk-visually-hidden\">${accessibleLabel}</span><span aria-hidden=\"true\">${label}</span>`\n    this.date = new Date(day)\n  }\n\n  /**\n   * @param {MouseEvent} event - Click event\n   */\n  click(event) {\n    this.picker.goToDate(this.date)\n    this.picker.selectDate(this.date)\n\n    event.stopPropagation()\n    event.preventDefault()\n  }\n\n  /**\n   * @param {KeyboardEvent} event - Keydown event\n   */\n  keyPress(event) {\n    let calendarNavKey = true\n\n    switch (event.key) {\n      case 'ArrowLeft':\n        this.picker.focusPreviousDay()\n        break\n      case 'ArrowRight':\n        this.picker.focusNextDay()\n        break\n      case 'ArrowUp':\n        this.picker.focusPreviousWeek()\n        break\n      case 'ArrowDown':\n        this.picker.focusNextWeek()\n        break\n      case 'Home':\n        this.picker.focusFirstDayOfWeek()\n        break\n      case 'End':\n        this.picker.focusLastDayOfWeek()\n        break\n      case 'PageUp': {\n        if (event.shiftKey) {\n          this.picker.focusPreviousYear(event)\n        } else {\n          this.picker.focusPreviousMonth(event)\n        }\n        break\n      }\n      case 'PageDown': {\n        if (event.shiftKey) {\n          this.picker.focusNextYear(event)\n        } else {\n          this.picker.focusNextMonth(event)\n        }\n        break\n      }\n      default:\n        calendarNavKey = false\n        break\n    }\n\n    if (calendarNavKey) {\n      event.preventDefault()\n      event.stopPropagation()\n    }\n  }\n}\n\n/**\n * Date picker config\n *\n * @typedef {object} DatePickerConfig\n * @property {string} [excludedDates] - Dates that cannot be selected\n * @property {string} [excludedDays] - Days that cannot be selected\n * @property {boolean} [leadingZeros] - Whether to add leading zeroes when populating the field\n * @property {string} [minDate] - The earliest available date\n * @property {string} [maxDate] - The latest available date\n * @property {string} [weekStartDay] - First day of the week in calendar view\n * @property {object} [input] - Input config\n * @property {string} [input.selector] - Selector for the input element\n * @property {Element | null} [input.element] - HTML element for the input\n */\n\n/**\n * @import { Schema } from 'govuk-frontend/dist/govuk/common/configuration.mjs'\n */\n"],"names":["DatePicker","ConfigurableComponent","constructor","$root","config","_this$config$input$el","$input","input","element","querySelector","selector","HTMLInputElement","dayLabels","monthLabels","currentDate","Date","setHours","calendarDays","excludedDates","excludedDays","buttonClass","selectedDayButtonClass","currentDayButtonClass","todayButtonClass","setOptions","initControls","id","$dialog","createDialog","createCalendarHeaders","$componentWrapper","document","createElement","$inputWrapper","classList","add","parentElement","insertBefore","appendChild","insertAdjacentHTML","toggleTemplate","insertAdjacentElement","$calendarButton","$dialogTitle","createCalendar","$prevMonthButton","$prevYearButton","$nextMonthButton","$nextYearButton","$cancelButton","$okButton","addEventListener","event","focusPreviousMonth","focusPreviousYear","focusNextMonth","focusNextYear","preventDefault","closeDialog","selectDate","$dialogButtons","querySelectorAll","$firstButtonInDialog","$lastButtonInDialog","length","firstButtonKeydown","lastButtonKeydown","toggleDialog","key","stopPropagation","body","backgroundClick","updateCalendar","titleId","setAttribute","innerHTML","dialogTemplate","hidden","$tbody","dayCount","i","$row","insertRow","j","$cell","$dateButton","calendarDay","DSCalendarDay","push","forEach","day","html","substring","$headerRow","leadingZeros","value","ret","toString","setMinAndMaxDatesOnCalendar","setExcludedDates","setExcludedDays","setWeekStartDay","minDate","formattedDateFromString","maxDate","replace","split","map","item","includes","parseDateRangeString","reduce","dates","items","concat","filter","date","datestring","startDate","endDate","d","getTime","setDate","getDate","weekDays","toLowerCase","weekStartDay","unshift","pop","indexOf","weekStartDayParam","isExcludedDate","excludedDate","toDateString","getDay","dateString","fallback","formattedDate","dateFormatPattern","test","match","exec","month","year","Number","isFinite","formattedDateFromDate","getMonth","getFullYear","formattedDateHuman","isOpen","target","Node","contains","shiftKey","focus","firstOfMonth","dayOfWeek","thisDay","disabled","update","setCurrentDate","$button","remove","calendarDayDate","today","inputDate","removeAttribute","enabledDays","window","getComputedStyle","display","innerText","changeEvent","Event","bubbles","cancelable","dispatchEvent","openDialog","offsetWidth","style","right","top","offsetHeight","goToDate","current","focusNextDay","focusPreviousDay","focusNextWeek","focusPreviousWeek","focusFirstDayOfWeek","firstDayOfWeekIndex","diff","focusLastDayOfWeek","lastDayOfWeekIndex","setMonth","setFullYear","moduleName","defaults","Object","freeze","schema","properties","type","index","row","column","picker","keyPress","bind","click","label","accessibleLabel","calendarNavKey"],"mappings":"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"}